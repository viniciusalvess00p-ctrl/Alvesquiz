<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Bandeiras do Mundo</title>
    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #2c3e50;
            --success: #27ae60;
            --error: #e74c3c;
            --bg: #f0f2f5;
            --card: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--secondary);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-card {
            background: var(--card);
            width: 100%;
            max-width: 500px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .header {
            margin-bottom: 20px;
        }

        h1 {
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            color: var(--primary);
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .flag-box {
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            overflow: hidden;
            border-radius: 12px;
            background-color: #eee; /* Placeholder enquanto carrega */
        }

        .flag-box img {
            max-width: 100%;
            max-height: 100%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-radius: 4px;
            object-fit: contain;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 400px) {
            .options-grid {
                grid-template-columns: 1fr; /* Um bot√£o abaixo do outro em telas pequenas */
            }
        }

        button.option {
            background: white;
            border: 2px solid #e1e4e8;
            padding: 15px 10px;
            border-radius: 12px;
            font-size: 1rem;
            color: var(--secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
        }

        button.option:hover:not(:disabled) {
            border-color: var(--primary);
            color: var(--primary);
            background: #fbfdff;
        }

        button.correct {
            background-color: var(--success) !important;
            border-color: var(--success) !important;
            color: white !important;
        }

        button.wrong {
            background-color: var(--error) !important;
            border-color: var(--error) !important;
            color: white !important;
            opacity: 0.6;
        }

        .next-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
            display: none; /* Escondido por padr√£o */
            animation: popIn 0.3s ease;
        }

        .loader {
            color: var(--primary);
            font-weight: bold;
            margin: 20px 0;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

    </style>
</head>
<body>

    <div class="game-card">
        <div class="header">
            <h1>Mestre das Bandeiras</h1>
            <div class="stats-bar">
                <span>üèÜ Recorde: <span id="high-score">0</span></span>
                <span>‚≠ê Pontos: <span id="score">0</span></span>
            </div>
        </div>

        <div id="loading" class="loader">Carregando bandeiras do mundo...</div>

        <div id="game-area" style="display: none;">
            <div class="flag-box">
                <img id="flag-img" src="" alt="Bandeira">
            </div>

            <div class="options-grid" id="options-container">
                </div>

            <div id="feedback" style="margin-top: 15px; font-weight: bold; height: 20px;"></div>

            <button class="next-btn" id="next-btn" onclick="nextRound()">Pr√≥xima Bandeira ‚ûî</button>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let allCountries = [];
        let currentCountry = null;
        let score = 0;
        let highScore = localStorage.getItem('flagHighScore') || 0;
        let isAnswered = false;

        // Elementos do DOM
        const loadingEl = document.getElementById('loading');
        const gameAreaEl = document.getElementById('game-area');
        const flagImg = document.getElementById('flag-img');
        const optionsContainer = document.getElementById('options-container');
        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('high-score');
        const feedbackEl = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');

        // Inicializa o placar
        highScoreEl.textContent = highScore;

        // 1. Buscar dados da API RestCountries
        async function fetchCountries() {
            try {
                // Buscamos apenas os campos necess√°rios: nome, bandeiras e tradu√ß√µes
                const response = await fetch('https://restcountries.com/v3.1/all?fields=name,flags,cca2');
                const data = await response.json();

                // Processar dados para um formato mais limpo
                allCountries = data.map(country => {
                    // Tenta pegar o nome em portugu√™s, se n√£o der, pega o comum em ingl√™s
                    const ptName = country.translations?.por?.common || country.name.common;
                    return {
                        name: ptName,
                        flag: country.flags.svg, // Imagem SVG de alta qualidade
                        code: country.cca2
                    };
                });

                // Remover entradas sem nome ou duplicadas se houver
                allCountries = allCountries.filter(c => c.name && c.flag);

                startGame();
            } catch (error) {
                loadingEl.textContent = "Erro ao carregar bandeiras. Verifique sua internet.";
                loadingEl.style.color = "red";
                console.error(error);
            }
        }

        function startGame() {
            loadingEl.style.display = 'none';
            gameAreaEl.style.display = 'block';
            nextRound();
        }

        function nextRound() {
            isAnswered = false;
            nextBtn.style.display = 'none';
            feedbackEl.textContent = '';
            optionsContainer.innerHTML = '';

            // 1. Escolher pa√≠s correto
            const randomIndex = Math.floor(Math.random() * allCountries.length);
            currentCountry = allCountries[randomIndex];

            // 2. Escolher 3 distratores (op√ß√µes erradas)
            let options = [currentCountry];
            while (options.length < 4) {
                const randomWrong = allCountries[Math.floor(Math.random() * allCountries.length)];
                // Evitar duplicatas
                if (!options.includes(randomWrong)) {
                    options.push(randomWrong);
                }
            }

            // 3. Embaralhar op√ß√µes
            options.sort(() => Math.random() - 0.5);

            // 4. Renderizar Tela
            flagImg.src = currentCountry.flag;

            options.forEach(country => {
                const btn = document.createElement('button');
                btn.className = 'option';
                btn.textContent = country.name;
                btn.onclick = () => checkAnswer(country, btn);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selected, btnElement) {
            if (isAnswered) return;
            isAnswered = true;

            const buttons = document.querySelectorAll('.option');

            if (selected.code === currentCountry.code) {
                // ACERTOU
                btnElement.classList.add('correct');
                score++;
                feedbackEl.textContent = "Acertou! üéâ";
                feedbackEl.style.color = "var(--success)";
                
                // Atualiza Recorde
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('flagHighScore', highScore);
                    highScoreEl.textContent = highScore;
                }
            } else {
                // ERROU
                btnElement.classList.add('wrong');
                score = 0; // Reseta pontua√ß√£o no modo desafio (opcional)
                feedbackEl.textContent = `Ops! A resposta era ${currentCountry.name}`;
                feedbackEl.style.color = "var(--error)";

                // Mostra a correta
                buttons.forEach(btn => {
                    if (btn.textContent === currentCountry.name) {
                        btn.classList.add('correct');
                    }
                });
            }

            scoreEl.textContent = score;
            nextBtn.style.display = 'inline-block';
        }

        // Iniciar busca de dados
        fetchCountries();

    </script>
</body>
</html>
